---

title: NASA NC4 Loader

keywords: fastai
sidebar: home_sidebar



---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: notebooks/oco2peak-nc4_convert.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Get-the-content-of-a-directory">Get the content of a directory<a class="anchor-link" href="#Get-the-content-of-a-directory"> </a></h2><p>A filter allow you to get only some file. Useful to process only a month for example.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_file_list" class="doc_header"><code>get_file_list</code><a href="https://github.com/trancept/oco2peak/tree/master/oco2peak/nc4_convert.py#L16" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_file_list</code>(<strong><code>nc4_directory</code></strong>, <strong><code>pattern</code></strong>=<em>`'</em>.nc4'`*)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">last_nc4</span> <span class="o">=</span> <span class="n">get_file_list</span><span class="p">(</span><span class="s1">&#39;/media/NAS-Divers/dev/datasets/OCO2/nc4-v10/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">last_nc4</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;/media/NAS-Divers/dev/datasets/OCO2/nc4-v10/oco2_LtCO2_20200407_B10offline.nc4&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Open-the-file-with-netCDF4">Open the file with netCDF4<a class="anchor-link" href="#Open-the-file-with-netCDF4"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_nc4_raw_content" class="doc_header"><code>get_nc4_raw_content</code><a href="https://github.com/trancept/oco2peak/tree/master/oco2peak/nc4_convert.py#L22" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_nc4_raw_content</code>(<strong><code>one_file</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This allow you to get info from the file by yourself.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">get_nc4_raw_content</span><span class="p">(</span><span class="n">last_nc4</span><span class="p">)</span><span class="o">.</span><span class="n">groups</span><span class="p">[</span><span class="s1">&#39;Sounding&#39;</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&lt;class &#39;netCDF4._netCDF4.Group&#39;&gt;
group /Sounding:
    dimensions(sizes): 
    variables(dimensions): float32 solar_azimuth_angle(sounding_id), float32 sensor_azimuth_angle(sounding_id), float32 polarization_angle(sounding_id), int8 land_fraction(sounding_id), float32 glint_angle(sounding_id), float32 airmass(sounding_id), float32 snr_o2a(sounding_id), float32 snr_wco2(sounding_id), float32 snr_sco2(sounding_id), int32 l1b_type(sounding_id), int8 operation_mode(sounding_id), int32 orbit(sounding_id), uint8 path(sounding_id), int8 footprint(sounding_id), int8 land_water_indicator(sounding_id), float32 altitude(sounding_id), float32 altitude_stddev(sounding_id)
    groups: </pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>To get the version of the NASA pipeline :</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">get_nc4_raw_content</span><span class="p">(</span><span class="n">last_nc4</span><span class="p">)</span><span class="o">.</span><span class="n">BuildId</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;B10.0.04&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Extract-the-useful-informations">Extract the useful informations<a class="anchor-link" href="#Extract-the-useful-informations"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_np_table" class="doc_header"><code>get_np_table</code><a href="https://github.com/trancept/oco2peak/tree/master/oco2peak/nc4_convert.py#L28" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_np_table</code>(<strong><code>one_file</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">np_table</span> <span class="o">=</span>  <span class="n">get_np_table</span><span class="p">(</span><span class="n">last_nc4</span><span class="p">)</span>
<span class="n">np_table</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(202617, 14)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Convert-them-to-Pandas">Convert them to Pandas<a class="anchor-link" href="#Convert-them-to-Pandas"> </a></h2><p>This method take a list of file in argument, and process them all in one Pandas Dataframe.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_dataframe" class="doc_header"><code>get_dataframe</code><a href="https://github.com/trancept/oco2peak/tree/master/oco2peak/nc4_convert.py#L50" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_dataframe</code>(<strong><code>nc4_list</code></strong>, <strong><code>master_progress_bar</code></strong>=<em><code>None</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">get_dataframe</span><span class="p">([</span><span class="n">last_nc4</span><span class="p">])</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">

    <div>
        <style>
            /* Turns off some styling */
            progress {
                /* gets rid of default border in Firefox and Opera. */
                border: none;
                /* Needs to be in here for Safari polyfill so background images work as expected. */
                background-size: auto;
            }
            .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
                background: #F44336;
            }
        </style>
      <progress value='1' class='' max='1', style='width:300px; height:20px; vertical-align: middle;'></progress>
      100.00% [1/1 00:00<00:00]
    </div>
    


    <div>
        <style>
            /* Turns off some styling */
            progress {
                /* gets rid of default border in Firefox and Opera. */
                border: none;
                /* Needs to be in here for Safari polyfill so background images work as expected. */
                background-size: auto;
            }
            .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
                background: #F44336;
            }
        </style>
      <progress value='1' class='' max='1', style='width:300px; height:20px; vertical-align: middle;'></progress>
      100.00% [1/1 00:00<00:00]
    </div>
    
</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>sounding_id</th>
      <th>latitude</th>
      <th>longitude</th>
      <th>xco2</th>
      <th>xco2_uncert</th>
      <th>orbit</th>
      <th>windspeed_u</th>
      <th>windspeed_v</th>
      <th>surface_pressure_apriori</th>
      <th>surface_pressure</th>
      <th>altitude</th>
      <th>land_water_indicator</th>
      <th>land_fraction</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>7</th>
      <td>2020040700492638</td>
      <td>-42.680946</td>
      <td>-163.926727</td>
      <td>409.077057</td>
      <td>0.494898</td>
      <td>30665</td>
      <td>-8.192998</td>
      <td>-1.161757</td>
      <td>1005.479065</td>
      <td>996.547852</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>13</th>
      <td>2020040700492703</td>
      <td>-42.659702</td>
      <td>-163.818771</td>
      <td>409.052002</td>
      <td>0.489938</td>
      <td>30665</td>
      <td>-7.951118</td>
      <td>-1.333183</td>
      <td>1005.495911</td>
      <td>996.656250</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>16</th>
      <td>2020040700492707</td>
      <td>-42.648354</td>
      <td>-163.912247</td>
      <td>408.720642</td>
      <td>0.471686</td>
      <td>30665</td>
      <td>-8.057251</td>
      <td>-1.286553</td>
      <td>1005.430115</td>
      <td>997.372009</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Helpers-function-to-process-many-files">Helpers function to process many files<a class="anchor-link" href="#Helpers-function-to-process-many-files"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_pattern_yearmonth" class="doc_header"><code>get_pattern_yearmonth</code><a href="https://github.com/trancept/oco2peak/tree/master/oco2peak/nc4_convert.py#L78" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_pattern_yearmonth</code>()</p>
</blockquote>
<p>Generate a list of every YYMM from 2014 to 2020</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="process_files" class="doc_header"><code>process_files</code><a href="https://github.com/trancept/oco2peak/tree/master/oco2peak/nc4_convert.py#L88" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>process_files</code>(<strong><code>input_dir</code></strong>, <strong><code>output_dir</code></strong>, <strong><code>patterns</code></strong>)</p>
</blockquote>
<p>Process all NC4 file corresponding to the patterns list.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Example-usage">Example usage<a class="anchor-link" href="#Example-usage"> </a></h1>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">years_months</span> <span class="o">=</span> <span class="n">get_pattern_yearmonth</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">years_months</span><span class="p">)</span>
<span class="n">input_dir</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;/media/NAS-Divers/dev/datasets/OCO2/nc4-v10/&#39;</span>
<span class="n">output_dir</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;../../../datasets/OCO2/csv-v10/&#39;</span>
<span class="c1"># Replace [&#39;1409&#39;] by years_months to process every files.</span>
<span class="n">process_files</span><span class="p">(</span><span class="n">input_dir</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;1409&#39;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[&#39;1401&#39;, &#39;1402&#39;, &#39;1403&#39;, &#39;1404&#39;, &#39;1405&#39;, &#39;1406&#39;, &#39;1407&#39;, &#39;1408&#39;, &#39;1409&#39;, &#39;1410&#39;, &#39;1411&#39;, &#39;1412&#39;, &#39;1501&#39;, &#39;1502&#39;, &#39;1503&#39;, &#39;1504&#39;, &#39;1505&#39;, &#39;1506&#39;, &#39;1507&#39;, &#39;1508&#39;, &#39;1509&#39;, &#39;1510&#39;, &#39;1511&#39;, &#39;1512&#39;, &#39;1601&#39;, &#39;1602&#39;, &#39;1603&#39;, &#39;1604&#39;, &#39;1605&#39;, &#39;1606&#39;, &#39;1607&#39;, &#39;1608&#39;, &#39;1609&#39;, &#39;1610&#39;, &#39;1611&#39;, &#39;1612&#39;, &#39;1701&#39;, &#39;1702&#39;, &#39;1703&#39;, &#39;1704&#39;, &#39;1705&#39;, &#39;1706&#39;, &#39;1707&#39;, &#39;1708&#39;, &#39;1709&#39;, &#39;1710&#39;, &#39;1711&#39;, &#39;1712&#39;, &#39;1801&#39;, &#39;1802&#39;, &#39;1803&#39;, &#39;1804&#39;, &#39;1805&#39;, &#39;1806&#39;, &#39;1807&#39;, &#39;1808&#39;, &#39;1809&#39;, &#39;1810&#39;, &#39;1811&#39;, &#39;1812&#39;, &#39;1901&#39;, &#39;1902&#39;, &#39;1903&#39;, &#39;1904&#39;, &#39;1905&#39;, &#39;1906&#39;, &#39;1907&#39;, &#39;1908&#39;, &#39;1909&#39;, &#39;1910&#39;, &#39;1911&#39;, &#39;1912&#39;, &#39;2001&#39;, &#39;2002&#39;, &#39;2003&#39;, &#39;2004&#39;, &#39;2005&#39;, &#39;2006&#39;, &#39;2007&#39;, &#39;2008&#39;, &#39;2009&#39;, &#39;2010&#39;, &#39;2011&#39;, &#39;2012&#39;]
</pre>
</div>
</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
Loading 1409<p>Saving to disk...
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">nbdev.export</span> <span class="kn">import</span> <span class="n">notebook2script</span>
<span class="n">notebook2script</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Converted 03_25_OCO2_Data_Exploration.ipynb.
Converted 04_01_OCO2_Work_Base.ipynb.
Converted 04_04_OCO2_China_Peaks.ipynb.
Converted 04_15_OCO2_Laiwu_Peak_Detection.ipynb.
Converted CO2_emissions_Inventory_data.ipynb.
Converted Christian-datasets-Distances.ipynb.
Converted Find_Peaks_with_LSTM_autoencoders.ipynb.
Converted Laiwu_Plume-more_data.ipynb.
Converted Laiwu_Plume-more_data_CD_exploration_selection_peaks.ipynb.
Converted Laiwu_Plume.ipynb.
Converted Untitled.ipynb.
Converted WIP_OCO2_Capture.ipynb.
Converted WIP_OCO2_Peaks_Wind.ipynb.
Converted WIP_OCO2_Peaks_Wind_Visualization.ipynb.
Converted find_peak_bco_test.ipynb.
Converted index.ipynb.
Converted oco2peak-datasets.ipynb.
Converted oco2peak-find_peak.ipynb.
Converted oco2peak-map.ipynb.
Converted oco2peak-nc4_convert.ipynb.
Converted oco2peak-swift_utils.ipynb.
Converted show_map.ipynb.
Converted view_peak.ipynb.
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

